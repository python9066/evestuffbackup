import{d as h,u as oa,i as na,ay as da,az as ia,a as ca,r as S,a2 as ra,o as ua,b as fa,c as u,e as f,j as i,f as l,w as o,aA as ma,aB as H,C as p,B as pa,q as b,l as n,ah as ga,_ as k,h as d,n as T,aC as C,A as r,z as A,aD as L,Q as va,aE as Q,m as x,s as ya,x as B,F as _a,t as ha,v as Sa,G as ka}from"./app.67871f28.js";import{Q as Ta,a as E}from"./QTabPanels.ad9626b2.js";import{c as wa}from"./copy-to-clipboard.653c5991.js";const ba={class:"q-ma-md"},Ca={class:"row q-gutter-lg"},La={key:0,class:"col-9"},xa={class:"col-2"},Ea={key:0,class:"col-auto"},Ia={class:"col"},Va={class:"row justify-between items-center"},Da={class:"col-auto text-h6"},Aa={class:"col-2"},Ha={class:"col text-h6"},Qa={class:"col text-h6"},Ba={class:"col text-h6"},ja={key:0,class:"text-red"},za={key:1,class:"text-red"},Pa={key:2,class:"text-primary"},Ua={key:1,class:"col-auto text-h6"},Oa={key:2,class:"col-auto"},Ra=i("span",{class:"q-ml-sm"},"There was a error with the EVE ESI while trying add the local scan. You may need to enter the scan again",-1),Ma={__name:"Dscan",setup($a){const I=h(()=>k(()=>import("./DscanTotal.125679f4.js"),["assets/DscanTotal.125679f4.js","assets/app.67871f28.js","assets/app.4fce15f2.css"])),j=h(()=>k(()=>import("./DscanLocal.6b096bde.js"),["assets/DscanLocal.6b096bde.js","assets/app.67871f28.js","assets/app.4fce15f2.css","assets/QImg.67e8e479.js","assets/DscanLocal.b8f11a2e.css"])),z=h(()=>k(()=>import("./DscanHistoryList.c9389a5f.js"),["assets/DscanHistoryList.c9389a5f.js","assets/app.67871f28.js","assets/app.4fce15f2.css"])),P=h(()=>k(()=>import("./DscanMessage.c754037a.js"),["assets/DscanMessage.c754037a.js","assets/app.67871f28.js","assets/app.4fce15f2.css","assets/QBadge.a4c4cc1b.js","assets/QChatMessage.d448481d.js","assets/DscanMessage.f247a9ce.css"])),U=h(()=>k(()=>import("./index.7f38dd25.js"),["assets/index.7f38dd25.js","assets/app.67871f28.js","assets/app.4fce15f2.css"]));let e=oa();na("can");const O=da();let V=ia(),w=ca(),c=S(null),y=S(null),v=S(!1),g=S("total"),D=S(!1);ra(()=>{}),ua(async()=>{document.title="Evestuff - Dscan",c.value=V.params.link?V.params.link:null,Echo.private("dscanall").listen("DscanAllUpdate",a=>{a.flag.flag==1}),await R()}),fa(()=>{Echo.leave("dscansolo."+c.value),Echo.leave("dscanall")});let R=async()=>{c.value&&(await e.getDscan(c.value),e.dScanIsHistory||Echo.private("dscansolo."+c.value).listen("dScanSoloUpdate",a=>{a.flag.flag==1&&(D.value=!0),a.flag.flag==2&&(e.dScanLocalCorp=a.flag.message.corpsTotal,e.dScanLocalAlliance=a.flag.message.allianceTotal,e.dScanLocalAffiliation=a.flag.message.affiliationTotal,e.updateLocalDscan(a.flag.message.soloLocal)),a.flag.flag==3&&(e.dScanLocalCorp=a.flag.message),a.flag.flag==4&&(e.dScanLocalAlliance=a.flag.message),a.flag.flag==5&&(e.dScan=a.flag.message,e.dScanHistory=a.flag.message.history),a.flag.flag==6&&(e.dScanIsHistory=a.flag.message),a.flag.flag==7&&(e.dScanItemCategory=a.flag.message),a.flag.flag==8&&(e.dScanItemGroup=a.flag.message),a.flag.flag==9&&(e.dScanItemItem=a.flag.message),a.flag.flag==10&&(e.dScanLocalAffiliation=a.flag.message),a.flag.flag==11&&w.push({path:"/dscanisnomore"}),a.flag.flag==12&&(e.dScanMessages=a.flag.message)}))},$=u(()=>!!e.dScan),G=u(()=>e.dScan.system?e.dScan.system.system_name:"unknown"),q=u(()=>e.dScan.madeby?e.dScan.madeby.name:"unknown"),N=u(()=>e.dScan.updated_by?e.dScan.updated_by.name:"unknown"),M=u(()=>e.dScan.updated_at?e.dScan.updated_at:"unknown"),F=async()=>{v.value=!0;var a={text:y.value};await axios({method:"post",withCredentials:!0,data:a,url:"/api/dscan",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>{v.value=!1,w.push({path:`/dscan/${t.data.link}/`})})},Y=async()=>{v.value=!0;var a={text:y.value};await axios({method:"post",withCredentials:!0,data:a,url:"/api/dscan/"+c.value,headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>{v.value=!1,e.dScanLocalCorp=t.data.data.corpsTotal,e.dScanLocalAlliance=t.data.data.allianceTotal,e.dScan=t.data.data.dscan,e.dScanHistory=t.data.data.dscan.history,t.data.data.categoryTotals&&(e.dScanItemCategory=t.data.data.categoryTotals),t.data.data.groupTotals&&(e.dScanItemGroup=t.data.data.groupTotals),t.data.data.itemTotals&&(e.dScanItemItem=t.data.data.itemTotals),t.data.data.affiliationTotal&&(e.dScanLocalAffiliation=t.data.data.affiliationTotal),y.value=null})},J=a=>{if(!a)return 0;let t=a,m=new Date(t).getTimezoneOffset()*6e4;return Date.parse(t)-m},K=u(()=>c.value?"full-height justify-between":"q-gutter-lg full-height justify-end"),W=a=>a==c.value,X=a=>{w.push({path:`/dscan/${a.link}/${la(a)}`})},Z=()=>{w.push({path:`/dscan/${e.dScanLiveLink}/${g.value}`})},aa=u(()=>{let a=70;return"height:"+(e.size.height-a+"px")}),ea=u(()=>e.dScan&&e.dScan.locals&&e.dScan.locals.length>0),ta=()=>{let a="https://evestuff.apps.gnf.lt"+V.path;wa(a).then(()=>{O.notify({type:"info",message:a+" copied to your clipboard"})})},la=a=>{if(g.value=="local"){let t=0;return!a.corpsTotal||Object.values(a.corpsTotal).length==0?t=0:Object.values(a.corpsTotal).forEach(s=>{t+=s.totalInSystem}),t>0?"local":"total"}return g.value},sa=u(()=>{let a=500;return"max-height:"+(e.size.height-a+"px")});return(a,t)=>(d(),f("div",ba,[i("div",Ca,[$.value?(d(),f("div",La,[l(ma,{dense:"",modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),class:"text-teal"},{default:o(()=>[ea.value?(d(),T(C,{key:0,name:"local",label:"Local"})):p("",!0),l(C,{name:"total",label:"Total"}),l(C,{name:"onGrid",label:"On Grid"}),l(C,{name:"offGrid",label:"Off Grid"})]),_:1},8,["modelValue"]),l(Ta,{style:H(aa.value),modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=s=>g.value=s),animated:""},{default:o(()=>[l(E,{name:"local"},{default:o(()=>[l(n(j))]),_:1}),l(E,{name:"total"},{default:o(()=>[l(n(I),{type:1})]),_:1}),l(E,{name:"onGrid"},{default:o(()=>[l(n(I),{type:2})]),_:1}),l(E,{name:"offGrid"},{default:o(()=>[l(n(I),{type:3})]),_:1})]),_:1},8,["style","modelValue"])])):p("",!0),i("div",xa,[i("div",{class:pa([K.value,"column"])},[c.value?(d(),f("div",Ea,[l(b,{class:"my-card"},{default:o(()=>[i("div",Ia,[i("div",Va,[i("div",Da,"System: "+r(G.value),1),i("div",Aa,[l(n(P))])])]),i("div",Ha,"Created By: "+r(q.value),1),i("div",Qa,"Edited By: "+r(N.value),1),i("div",Ba,[A(" Last Updated: "),l(n(U),{class:"q-pl-sm","emit-events":!1,time:n(J)(M.value),interval:1e3},{default:o(({hours:s,minutes:m,seconds:_})=>[s>=1?(d(),f("span",ja,r(s)+":"+r(m)+":"+r(_),1)):m>=20?(d(),f("span",za,r(m)+":"+r(_),1)):(d(),f("span",Pa,r(m)+":"+r(_),1))]),_:1},8,["time"])])]),_:1})])):p("",!0),n(e).dScanIsHistory?p("",!0):(d(),f("div",Ua,[l(b,{class:"my-card myRoundTop"},{default:o(()=>[l(L,null,{default:o(()=>[l(va,{modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=s=>y.value=s),type:"textarea",label:"Paste your Dscan or local here"},null,8,["modelValue"])]),_:1}),l(Q,{align:"center"},{default:o(()=>[l(x,{rounded:"",color:"primary",label:"New",loading:v.value,onClick:t[3]||(t[3]=s=>n(F)())},null,8,["loading"]),c.value?(d(),T(x,{key:0,rounded:"",color:"secondary",label:"Update",loading:v.value,onClick:t[4]||(t[4]=s=>n(Y)())},null,8,["loading"])):p("",!0),n(e).dScanHistory.length||n(e).dScanIsHistory?(d(),T(x,{key:1,color:"accent",rounded:"",label:"Share",onClick:n(ta)},null,8,["onClick"])):p("",!0)]),_:1})]),_:1})])),n(e).dScanHistory.length||n(e).dScanIsHistory?(d(),f("div",Oa,[l(b,{class:"my-card myRoundTop overflow-auto",style:H(sa.value)},{default:o(()=>[l(L,{class:"q-px-none"},{default:o(()=>[l(ya,{dense:""},{default:o(()=>[n(e).dScanIsHistory?(d(),T(B,{key:0,clickable:"",onClick:t[5]||(t[5]=s=>n(Z)())},{default:o(()=>[A(" Live ")]),_:1})):p("",!0),(d(!0),f(_a,null,ha(n(e).dScanHistory,(s,m)=>(d(),T(B,{class:"myListNoPadding",clickable:"",onClick:_=>n(X)(s),active:n(W)(s.link),key:m},{default:o(()=>[l(n(z),{list:s},null,8,["list"])]),_:2},1032,["onClick","active"]))),128))]),_:1})]),_:1})]),_:1},8,["style"])])):p("",!0)],2)])]),l(ga,{modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=s=>D.value=s),persistent:""},{default:o(()=>[l(b,{class:"myRoundTop"},{default:o(()=>[l(L,{class:"myCardHeader bg-warning text-center text-h5"},{default:o(()=>[A(" Somthing went wrong ")]),_:1}),l(L,{class:"row items-center"},{default:o(()=>[Ra]),_:1}),l(Q,{align:"right"},{default:o(()=>[Sa(l(x,{rounded:"",label:"close",color:"primary"},null,512),[[ka]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ma as default};
