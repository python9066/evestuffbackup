import{J as R,j as m,V as i,aP as E,i as F,e as G,d as W,_ as J,g as K,r as j,o as p,c as b,a as r,w as u,n as y,A as H,v as h,y as w,m as S,q as X,aS as V,k as B,bc as Y,F as Z,t as ee,Q as te,aT as ae,C as ne,u as d,ah as se,ba as z,G as le}from"./app.51849a21.js";import{Q as ie}from"./QBadge.646724f0.js";const oe=R({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(e,{slots:n}){const l=m(()=>e.sent===!0?"sent":"received"),q=m(()=>`q-message-text-content q-message-text-content--${l.value}`+(e.textColor!==void 0?` text-${e.textColor}`:"")),g=m(()=>`q-message-text q-message-text--${l.value}`+(e.bgColor!==void 0?` text-${e.bgColor}`:"")),C=m(()=>"q-message-container row items-end no-wrap"+(e.sent===!0?" reverse":"")),T=m(()=>e.size!==void 0?`col-${e.size}`:""),x=m(()=>({msg:e.textHtml===!0?"innerHTML":"textContent",stamp:e.stampHtml===!0?"innerHTML":"textContent",name:e.nameHtml===!0?"innerHTML":"textContent",label:e.labelHtml===!0?"innerHTML":"textContent"}));function $(o){return n.stamp!==void 0?[o,i("div",{class:"q-message-stamp"},n.stamp())]:e.stamp?[o,i("div",{class:"q-message-stamp",[x.value.stamp]:e.stamp})]:[o]}function _(o,c){const f=c===!0?o.length>1?v=>v:v=>i("div",[v]):v=>i("div",{[x.value.msg]:v});return o.map((v,k)=>i("div",{key:k,class:g.value},[i("div",{class:q.value},$(f(v)))]))}return()=>{const o=[];n.avatar!==void 0?o.push(n.avatar()):e.avatar!==void 0&&o.push(i("img",{class:`q-message-avatar q-message-avatar--${l.value}`,src:e.avatar,"aria-hidden":"true"}));const c=[];n.name!==void 0?c.push(i("div",{class:`q-message-name q-message-name--${l.value}`},n.name())):e.name!==void 0&&c.push(i("div",{class:`q-message-name q-message-name--${l.value}`,[x.value.name]:e.name})),n.default!==void 0?c.push(_(E(n.default()),!0)):e.text!==void 0&&c.push(_(e.text)),o.push(i("div",{class:T.value},c));const f=[];return n.label!==void 0?f.push(i("div",{class:"q-message-label"},n.label())):e.label!==void 0&&f.push(i("div",{class:"q-message-label",[x.value.label]:e.label})),f.push(i("div",{class:C.value},o)),i("div",{class:`q-message q-message-${l.value}`},f)}}});const re={class:"text-h6"},ue={key:0},de={key:1},ge={__name:"RcStationMessage",props:{station:Object,type:Number},setup(e){const n=e;F("can");let l=G();const q=W(()=>J(()=>import("./index.40d1b421.js"),["assets/index.40d1b421.js","assets/app.51849a21.js","assets/app.c946f8eb.css"]));K(async()=>{});let g=j(),C=j(!1);const T=async s=>{await z({method:"delete",url:"/api/sheetmessage/"+s,withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},x=async()=>{const s={message:g.value};await z({method:"put",url:"/api/sheetmessage/"+n.station.id,withCredentials:!0,data:s,headers:{Accept:"application/json","Content-Type":"application/json"}}),g.value=null};let $=async()=>{l.stationChatWindowId=n.station.id},_=async()=>{g.value=null,l.stationChatWindowId=null},o=s=>new Date(s).getTime(),c=s=>{const a=new Date(s);return new Date-a<18e5},f=m(()=>D.value.length),v=m(()=>l.getUnreadMessageCount(n.station.id)),k=m(()=>f.value?"fa-solid fa-message":"fa-regular fa-message"),Q=s=>l.user_id==s,A=(s,a)=>l.user_id==a?"me":s,L=s=>l.user_id==s?"amber-7":"positive",I=m(()=>!g.value),D=m(()=>l.getStationMessages(n.station.id)),P=s=>"https://image.eveonline.com/Character/"+s.user.eve_user_id+"_128.jpg";return(s,a)=>(p(),b("div",null,[r(S,{"text-color":"positive",icon:k.value,padding:"none",round:"",flat:"",onClick:a[0]||(a[0]=t=>C.value=!0)},{default:u(()=>[v.value&&!C.value?(p(),y(ie,{key:0,color:"red",floating:""},{default:u(()=>[H(h(v.value),1)]),_:1})):w("",!0)]),_:1},8,["icon"]),r(se,{modelValue:C.value,"onUpdate:modelValue":a[4]||(a[4]=t=>C.value=t),onBeforeShow:a[5]||(a[5]=t=>d($)()),onBeforeHide:a[6]||(a[6]=t=>d(_)())},{default:u(()=>[r(X,{class:"my-card myRoundTop",style:{width:"1000px","max-height":"900px",height:"900px"}},{default:u(()=>[r(V,{class:"bg-primary myCardHeader text-center"},{default:u(()=>[B("div",re,"Notes for Station "+h(n.station.name),1)]),_:1}),r(V,{id:"messages",class:"overflow-auto",style:{height:"600px"}},{default:u(()=>[r(Y,{"enter-active-class":"animate__animated animate__zoomIn"},{default:u(()=>[(p(!0),b(Z,null,ee(D.value,(t,U)=>(p(),y(oe,{key:`${t.id}-message`,text:[t.message],name:d(A)(t.user.name,t.user_id),avatar:d(P)(t),sent:d(Q)(t.user_id),"bg-color":d(L)(t.user_id)},{stamp:u(()=>[H("Sent: "),(p(),y(d(q),{key:`${t.id}-time`,interval:6e4,time:d(o)(t.created_at)},{default:u(({days:M,hours:N,minutes:O,seconds:me})=>[M!="00"?(p(),b("span",ue,h(M)+"days, ",1)):w("",!0),N!="00"?(p(),b("span",de,h(N)+"hours,",1)):w("",!0),B("span",null,h(O)+"minutes",1),H(" ago ")]),_:2},1032,["time"])),d(c)(t.created_at)&&d(Q)(t.user_id)?(p(),y(S,{key:0,color:"negative",padding:"none",icon:"fa-solid fa-trash-can",flat:"",size:"xs",rounded:"",onClick:M=>T(t.id)},null,8,["onClick"])):w("",!0)]),_:2},1032,["text","name","avatar","sent","bg-color"]))),128))]),_:1})]),_:1}),r(V,null,{default:u(()=>[B("div",null,[r(te,{"input-style":"height: 150px",modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=t=>g.value=t),clearable:"",outlined:"",rounded:"",dense:"",type:"textarea",label:"Message"},null,8,["modelValue"])])]),_:1}),r(ae,{align:"between"},{default:u(()=>[r(S,{rounded:"",label:"Submit",color:"primary",disable:I.value,onClick:a[2]||(a[2]=t=>x())},null,8,["disable"]),ne(r(S,{rounded:"",label:"Close",color:"negative",onClick:a[3]||(a[3]=t=>d(_)())},null,512),[[le]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{ge as default};
