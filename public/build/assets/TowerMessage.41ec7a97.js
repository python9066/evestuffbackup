import{p as z,n as F,v as G,_ as H,w as W,r as V,e as d,o as l,c,a as n,y as s,E as v,N as w,O as m,R as f,D as _,G as J,aF as y,A as C,b3 as K,I as q,J as X,C as o,B as Y,b1 as Z,K as ee,al as te,aE as D,U as ae}from"./app.e311c8d7.js";import{Q as ne}from"./QBadge.386343d9.js";import{Q as se}from"./QChatMessage.f3bb71e8.js";const oe={class:"text-h6"},le={key:0},re={key:1},pe={__name:"TowerMessage",props:{tower:Object,type:Number},setup(M){const u=M;z("can");let r=F();const Q=G(()=>H(()=>import("./index.7c6d6ad6.js"),["assets/index.7c6d6ad6.js","assets/app.e311c8d7.js","assets/app.78479e83.css"]));W(async()=>{});let i=V(),p=V(!1);const B=async a=>{await D({method:"delete",url:"/api/towermessage/"+a,withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}})},N=async()=>{const a={message:i.value};await D({method:"put",url:"/api/towermessage/"+u.tower.id,withCredentials:!0,data:a,headers:{Accept:"application/json","Content-Type":"application/json"}}),i.value=null};let $=async()=>{r.towerChatWindowId=u.tower.id},h=async()=>{i.value=null,r.towerChatWindowId=null},j=a=>new Date(a).getTime(),I=a=>{const t=new Date(a);return new Date-t<18e5},S=d(()=>T.value.length),x=d(()=>r.getTowerUnreadMessageCount(u.tower.id)),A=d(()=>S.value?"fa-solid fa-message":"fa-regular fa-message"),b=a=>r.user_id==a,U=(a,t)=>r.user_id==t?"me":a,E=a=>r.user_id==a?"amber-7":"positive",O=d(()=>!i.value),T=d(()=>r.getTowerMessages(u.tower.id)),L=a=>"https://image.eveonline.com/Character/"+a.user.eve_user_id+"_128.jpg";return(a,t)=>(l(),c("div",null,[n(_,{"text-color":"positive",icon:A.value,padding:"none",round:"",flat:"",onClick:t[0]||(t[0]=e=>p.value=!0)},{default:s(()=>[x.value&&!p.value?(l(),v(ne,{key:0,color:"red",floating:""},{default:s(()=>[w(m(x.value),1)]),_:1})):f("",!0)]),_:1},8,["icon"]),n(te,{modelValue:p.value,"onUpdate:modelValue":t[4]||(t[4]=e=>p.value=e),onBeforeShow:t[5]||(t[5]=e=>o($)()),onBeforeHide:t[6]||(t[6]=e=>o(h)())},{default:s(()=>[n(J,{class:"my-card myRoundTop",style:{width:"1000px","max-height":"900px",height:"900px"}},{default:s(()=>[n(y,{class:"bg-primary myCardHeader text-center"},{default:s(()=>[C("div",oe,"Notes for "+m(u.tower.moon.name),1)]),_:1}),n(y,{id:"messages",class:"overflow-auto",style:{height:"600px"}},{default:s(()=>[n(K,{"enter-active-class":"animate__animated animate__zoomIn"},{default:s(()=>[(l(!0),c(q,null,X(T.value,(e,P)=>(l(),v(se,{key:`${e.id}-message`,text:[e.message],name:o(U)(e.user.name,e.user_id),avatar:o(L)(e),sent:o(b)(e.user_id),"bg-color":o(E)(e.user_id)},{stamp:s(()=>[w("Sent: "),(l(),v(o(Q),{key:`${e.id}-time`,interval:6e4,time:o(j)(e.created_at)},{default:s(({days:g,hours:k,minutes:R,seconds:ie})=>[g!="00"?(l(),c("span",le,m(g)+"days, ",1)):f("",!0),k!="00"?(l(),c("span",re,m(k)+"hours,",1)):f("",!0),C("span",null,m(R)+"minutes",1),w(" ago ")]),_:2},1032,["time"])),o(I)(e.created_at)&&o(b)(e.user_id)?(l(),v(_,{key:0,color:"negative",padding:"none",icon:"fa-solid fa-trash-can",flat:"",size:"xs",rounded:"",onClick:g=>B(e.id)},null,8,["onClick"])):f("",!0)]),_:2},1032,["text","name","avatar","sent","bg-color"]))),128))]),_:1})]),_:1}),n(y,null,{default:s(()=>[C("div",null,[n(Y,{"input-style":"height: 150px",modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),clearable:"",outlined:"",rounded:"",dense:"",type:"textarea",label:"Message"},null,8,["modelValue"])])]),_:1}),n(Z,{align:"between"},{default:s(()=>[n(_,{rounded:"",label:"Submit",color:"primary",disable:O.value,onClick:t[2]||(t[2]=e=>N())},null,8,["disable"]),ee(n(_,{rounded:"",label:"Close",color:"negative",onClick:t[3]||(t[3]=e=>o(h)())},null,512),[[ae]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{pe as default};
