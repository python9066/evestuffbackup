import{d as k,_ as b,r as R,c as m,h as d,e as f,j as q,n as v,w as l,l as _,A as o,f as r,q as x,aF as U,Q as S,aI as D,v as T,m as p,p as I,B as Y,C,z as V,G as g}from"./app.c5dec28f.js";import{a as G}from"./QSelect.a13dd360.js";import"./QItemLabel.773e3f4d.js";const Z={class:"row"},A={class:"col"},J={key:0},K={key:0},te={__name:"NewSystemTableTimer",props:{node:Object,operationID:Number,extra:{type:Number,default:1},tidiProp:Number,systemIDProp:Number},setup(h){const e=h,O=k(()=>b(()=>import("./index.a906430b.js"),["assets/index.a906430b.js","assets/app.c5dec28f.js","assets/app.7b67968f.css"])),P=k(()=>b(()=>import("./index.1c07787f.js"),["assets/index.1c07787f.js","assets/app.c5dec28f.js","assets/app.7b67968f.css"]));let c=R(null),N=m(()=>!(e.node.node_status.id==7||e.node.node_status.id==8)),y=async()=>{var n=parseInt(c.value.substr(0,2)),t=parseInt(c.value.substr(3,2)),s=n*60+t;if(t=n*60+t,e.extra==2)var t=t/(e.tidiProp/100);else var t=t/(e.node.system.tidi/100);var a=new Date(Date.now()+t*1e3).toISOString().replace("T"," ").substr(0,19);if(e.node.node_status.id==7||e.node.node_status.id==8||e.node.node_status.id==9){var i={end_time:a,input_time:new Date().toISOString().replace("T"," ").substr(0,19),base_time:s,system_id:e.node.system_id};await axios({method:"put",url:"/api/addtimertonode/"+e.node.id,withCredentials:!0,data:i,headers:{Accept:"application/json","Content-Type":"application/json"}})}else{if(e.extra==1)var w=u.value.id,i={end_time:a,input_time:new Date().toISOString().replace("T"," ").substr(0,19),base_time:s,system_id:e.node.system_id};else var w=e.node.id,i={end_time:a,input_time:new Date().toISOString().replace("T"," ").substr(0,19),base_time:s,system_id:e.systemIDProp};await axios({method:"put",url:"/api/addprimetimer/"+w,withCredentials:!0,data:i,headers:{Accept:"application/json","Content-Type":"application/json"}})}},u=m(()=>e.extra==1&&e.node.prime_node_user.length>0?e.node.prime_node_user[0]:null),B=n=>{let t=n,a=new Date(t).getTimezoneOffset()*6e4;return Date.parse(t)-a},H=m(()=>{if(e.extra==1)if(e.node.node_status.id==2){var n=new Date(u.value.updated_at);return n.getUTCFullYear()+"-"+("0"+(n.getUTCMonth()+1)).slice(-2)+"-"+("0"+n.getUTCDate()).slice(-2)+" "+("0"+n.getUTCHours()).slice(-2)+":"+("0"+n.getUTCMinutes()).slice(-2)+":"+("0"+n.getUTCSeconds()).slice(-2)}else{var t=new Date(e.node.created_at);return t.getUTCFullYear()+"-"+("0"+(t.getUTCMonth()+1)).slice(-2)+"-"+("0"+t.getUTCDate()).slice(-2)+" "+("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)}else{var s=new Date(e.node.created_at);return s.toISOString()}}),M=m(()=>{if(e.extra==1)if(e.node.prime_node_user.length>0)var n=e.node.prime_node_user[0].node_status.id;else var n=e.node.node_status.id;else var n=e.node.node_status.id;switch(n){case 1:return!0;case 2:return!0;case 3:return!1;case 4:return!1;case 5:return!1;case 6:return!0;case 7:return!1;case 8:return!1;case 9:return!1;case 10:return!0}}),Q=(n,t,s)=>(t<5||n>0)&&e.node.node_status.id==1?!0:(t<10||n>0)&&e.node.node_status.id==2,j=m(()=>u.value?u.value.end_time==null&&u.value.node_status.id==3?!0:u.value.end_time==null&&(e.node.node_status.id==7||e.node.node_status.id==8||e.node.node_status.id==9):e.node.node_status.id==3&&e.node.end_time==null?!0:(e.node.node_status.id==7||e.node.node_status.id==8||e.node.node_status.id==9)&&e.node.end_time==null),E=m(()=>{if(e.extra==1)return u.value?u.value.end_time:e.node.node_status.id==7||e.node.node_status.id==8||e.node.node_status.id==9?e.node.end_time:null;if(e.node.end_time)return e.node.end_time}),$=n=>{const t=new Date(n+"Z"),s=Date.now();return t.getTime()-s},z=n=>{const t={};return Object.entries(n).forEach(([s,a])=>{t[s]=a<10?`0${a}`:String(a)}),t},F=m(()=>e.node.node_status.id==7?"text-white":"text-primary"),L=m(()=>{if(e.extra==1)if(e.node.prime_node_user.length>0)var n=u.value.node_status.id;else var n=e.node.node_status.id;else var n=e.node.node_status.id;return n==7||n==8||n==3||n==9});return(n,t)=>(d(),f("div",Z,[q("div",A,[M.value?(d(),v(_(O),{key:0,time:_(B)(H.value),"emit-events":!1,interval:1e3},{default:l(({hours:s,minutes:a,seconds:i})=>[_(Q)(s,s,i)?(d(),f("div",{key:`${e.node.id}-1-timer-age`,class:"text-positive"},o(s)+":"+o(a)+":"+o(i),1)):(d(),f("div",{key:`${e.node.id}-2-timer-age`,class:"text-negative"},o(s)+":"+o(a)+":"+o(i),1))]),_:1},8,["time"])):j.value?(d(),v(p,{key:1,color:"warning",outline:N.value,label:"Add time",rounded:"",class:"myOutLineButton"},{default:l(()=>[r(I,null,{default:l(()=>[r(x,{class:"my-card"},{default:l(()=>[r(U,null,{default:l(()=>[r(S,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),type:"text",label:"Hack Time mm:ss",mask:"##:##",autofocus:"",rounded:"",outlined:""},null,8,["modelValue"])]),_:1}),r(D,{align:"center"},{default:l(()=>[T(r(p,{color:"positive",rounded:"",label:"Add",onClick:t[1]||(t[1]=s=>_(y)())},null,512),[[g]]),T(r(p,{color:"negative",rounded:"",label:"Close"},null,512),[[g]])]),_:1})]),_:1})]),_:1})]),_:1},8,["outline"])):(d(),v(_(P),{key:2,time:_($)(E.value),interval:1e3,"emit-events":!1,transform:_(z)},{default:l(({hours:s,minutes:a,seconds:i})=>[e.node.node_status.id!=8?(d(),f("span",{key:0,class:Y(F.value)},[s>0?(d(),f("span",J,o(s)+":",1)):C("",!0),V(o(a)+":"+o(i),1)],2)):(d(),v(G,{key:1,color:"blue-14"},{default:l(()=>[s>0?(d(),f("span",K,o(s)+":",1)):C("",!0),V(o(a)+":"+o(i),1)]),_:2},1024))]),_:1},8,["time","transform"])),L.value?(d(),v(p,{key:3,color:"warning",icon:"fa-solid fa-edit",round:"",flat:"",size:"xs"},{default:l(()=>[r(I,{onBeforeHide:t[4]||(t[4]=s=>c.value=null)},{default:l(()=>[r(x,{class:"my-card"},{default:l(()=>[r(U,null,{default:l(()=>[r(S,{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=s=>c.value=s),type:"text",label:"Hack Time mm:ss",mask:"##:##",outlined:"",rounded:""},null,8,["modelValue"])]),_:1}),r(D,{align:"center"},{default:l(()=>[T(r(p,{rounded:"",color:"positive",label:"update",onClick:t[3]||(t[3]=s=>_(y)())},null,512),[[g]]),T(r(p,{rounded:"",color:"negative",label:"close"},null,512),[[g]])]),_:1})]),_:1})]),_:1})]),_:1})):C("",!0)])]))}};export{te as default};
