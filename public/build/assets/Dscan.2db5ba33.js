import{d as k,u as ta,i as la,ay as sa,az as na,a as oa,r as S,U as da,o as ia,b as ca,c as f,e as u,j as m,f as l,w as n,aA as ua,aB as B,C as g,B as ra,q as w,l as o,ab as fa,_ as T,h as d,n as b,aC as C,A as i,z as D,aD as L,Q as ma,aE as H,m as A,s as pa,x as U,F as ga,t as va,v as ya,G as _a}from"./app.7dc116da.js";import{Q as ha,a as x}from"./QTabPanels.ef843263.js";import{Q as Sa}from"./QChip.de420398.js";const ka={class:"q-ma-md"},wa={class:"row q-gutter-lg"},Ta={key:0,class:"col-9"},ba={class:"col-2"},Ca={key:0,class:"col-auto"},La={class:"col text-h6"},xa={class:"col text-h6"},Va={class:"col text-h6"},Ea={class:"col text-h6"},Ia={key:0,class:"text-red"},Da={key:0},Aa={key:1},Qa={key:1,class:"text-red"},Ba={key:1,class:"col-auto text-h6"},Ha={key:2,class:"col-auto"},Ua=m("span",{class:"q-ml-sm"},"There was a error with the EVE ESI while trying add the local scan. You may need to enter the scan again",-1),$a={__name:"Dscan",setup(za){const V=k(()=>T(()=>import("./DscanTotal.dc23b6ce.js"),["assets/DscanTotal.dc23b6ce.js","assets/app.7dc116da.js","assets/app.88cdf7f9.css"])),z=k(()=>T(()=>import("./DscanLocal.9f6f90fe.js"),["assets/DscanLocal.9f6f90fe.js","assets/app.7dc116da.js","assets/app.88cdf7f9.css","assets/QImg.1729271a.js","assets/DscanLocal.b8f11a2e.css"])),P=k(()=>T(()=>import("./DscanHistoryList.2d72231a.js"),["assets/DscanHistoryList.2d72231a.js","assets/app.7dc116da.js","assets/app.88cdf7f9.css"])),G=k(()=>T(()=>import("./index.b9859e15.js"),["assets/index.b9859e15.js","assets/app.7dc116da.js","assets/app.88cdf7f9.css"]));let a=ta();la("can"),sa();let y=na(),E=oa(),c=S(null),_=S(null),v=S(!1),r=S("total"),I=S(!1);da(()=>{}),ia(async()=>{document.title="Evestuff - Dscan",c.value=y.params.link?y.params.link:null,y.params.tab&&(y.params.tab=="local"?a.dScan&&a.dScan.locals&&a.dScan.locals.length>0?r.value="local":r.value="total":r.value=y.params.tab),Echo.private("dscanall").listen("DscanAllUpdate",e=>{e.flag.flag==1}),await R()}),ca(()=>{Echo.leave("dscansolo."+c.value),Echo.leave("dscanall")});let R=async()=>{c.value&&(await a.getDscan(c.value),a.dScanIsHistory||Echo.private("dscansolo."+c.value).listen("dScanSoloUpdate",e=>{e.flag.flag==1&&(I.value=!0),e.flag.flag==2&&(a.dScanLocalCorp=e.flag.message.corpsTotal,a.dScanLocalAlliance=e.flag.message.allianceTotal,a.dScanLocalAffiliation=e.flag.message.affiliationTotal,a.updateLocalDscan(e.flag.message.soloLocal)),e.flag.flag==3&&(a.dScanLocalCorp=e.flag.message),e.flag.flag==4&&(a.dScanLocalAlliance=e.flag.message),e.flag.flag==5&&(a.dScan=e.flag.message,a.dScanHistory=e.flag.message.history),e.flag.flag==6&&(a.dScanIsHistory=e.flag.message),e.flag.flag==7&&(a.dScanItemCategory=e.flag.message),e.flag.flag==8&&(a.dScanItemGroup=e.flag.message),e.flag.flag==9&&(a.dScanItemItem=e.flag.message),e.flag.flag==10&&(a.dScanLocalAffiliation=e.flag.message)}))},$=f(()=>!!a.dScan),j=f(()=>a.dScan.system?a.dScan.system.system_name:"unknown"),q=f(()=>a.dScan.madeby?a.dScan.madeby.name:"unknown"),N=f(()=>a.dScan.updated_by?a.dScan.updated_by.name:"unknown"),O=f(()=>a.dScan.updated_at?a.dScan.updated_at:"unknown"),M=async()=>{v.value=!0;var e={text:_.value};await axios({method:"post",withCredentials:!0,data:e,url:"/api/dscan",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>{v.value=!1,E.push({path:`/dscan/${t.data.link}/`})})},F=async()=>{v.value=!0;var e={text:_.value};await axios({method:"post",withCredentials:!0,data:e,url:"/api/dscan/"+c.value,headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>{v.value=!1,console.log(t.data),a.dScanLocalCorp=t.data.data.corpsTotal,a.dScanLocalAlliance=t.data.data.allianceTotal,a.dScan=t.data.data.dscan,a.dScanHistory=t.data.data.dscan.history,t.data.data.categoryTotals&&(a.dScanItemCategory=t.data.data.categoryTotals),t.data.data.groupTotals&&(a.dScanItemGroup=t.data.data.groupTotals),t.data.data.itemTotals&&(a.dScanItemItem=t.data.data.itemTotals),t.data.data.affiliationTotal&&(a.dScanLocalAffiliation=t.data.data.affiliationTotal),_.value=null})},Y=e=>{if(!e)return 0;let t=e,p=new Date(t).getTimezoneOffset()*6e4;return Date.parse(t)-p},J=f(()=>c.value?"full-height justify-between":"q-gutter-lg full-height justify-end"),K=e=>e==c.value,W=e=>{E.push({path:`/dscan/${e}/${r.value}`})},X=()=>{E.push({path:`/dscan/${a.dScanLiveLink}/${r.value}`})},Z=f(()=>{let e=70;return"height:"+(a.size.height-e+"px")}),aa=f(()=>!!(a.dScan&&a.dScan.locals&&a.dScan.locals.length>0)),ea=f(()=>{let e=500;return"max-height:"+(a.size.height-e+"px")});return(e,t)=>(d(),u("div",ka,[m("div",wa,[$.value?(d(),u("div",Ta,[l(ua,{dense:"",modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s),class:"text-teal"},{default:n(()=>[aa.value?(d(),b(C,{key:0,name:"local",label:"Local"})):g("",!0),l(C,{name:"total",label:"Total"}),l(C,{name:"onGrid",label:"On Grid"}),l(C,{name:"offGrid",label:"Off Grid"})]),_:1},8,["modelValue"]),l(ha,{style:B(Z.value),modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=s=>r.value=s),animated:""},{default:n(()=>[l(x,{name:"local"},{default:n(()=>[l(o(z))]),_:1}),l(x,{name:"total"},{default:n(()=>[l(o(V),{type:1})]),_:1}),l(x,{name:"onGrid"},{default:n(()=>[l(o(V),{type:2})]),_:1}),l(x,{name:"offGrid"},{default:n(()=>[l(o(V),{type:3})]),_:1})]),_:1},8,["style","modelValue"])])):g("",!0),m("div",ba,[m("div",{class:ra([J.value,"column"])},[c.value?(d(),u("div",Ca,[l(w,{class:"my-card"},{default:n(()=>[m("div",La,"System: "+i(j.value),1),m("div",xa,"Created By: "+i(q.value),1),m("div",Va,"Edited By: "+i(N.value),1),m("div",Ea,[D(" Last Updated: "),l(o(G),{class:"q-pl-sm","emit-events":!1,time:o(Y)(O.value),interval:1e3},{default:n(({hours:s,minutes:p,seconds:h,days:Q})=>[s<=1&&Q==0?(d(),u("span",Ia,[l(Sa,{class:"",filter:"",pill:"",clickable:"",color:"primary","text-color":"white"},{default:n(()=>[s==1?(d(),u("span",Da,i(s)+":"+i(p)+":"+i(h),1)):(d(),u("span",Aa,i(p)+":"+i(h),1))]),_:2},1024)])):(d(),u("span",Qa,[m("span",null,i(Q)+":"+i(s)+":"+i(p)+":"+i(h),1)]))]),_:1},8,["time"])])]),_:1})])):g("",!0),o(a).dScanIsHistory?g("",!0):(d(),u("div",Ba,[l(w,{class:"my-card myRoundTop"},{default:n(()=>[l(L,null,{default:n(()=>[l(ma,{modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=s=>_.value=s),type:"textarea",label:"Paste your Dscan or local here"},null,8,["modelValue"])]),_:1}),l(H,{align:"center"},{default:n(()=>[l(A,{rounded:"",color:"primary",label:"New",loading:v.value,onClick:t[3]||(t[3]=s=>o(M)())},null,8,["loading"]),c.value?(d(),b(A,{key:0,rounded:"",color:"secondary",label:"Update",loading:v.value,onClick:t[4]||(t[4]=s=>o(F)())},null,8,["loading"])):g("",!0)]),_:1})]),_:1})])),o(a).dScanHistory.length||o(a).dScanIsHistory?(d(),u("div",Ha,[l(w,{class:"my-card myRoundTop overflow-auto",style:B(ea.value)},{default:n(()=>[l(L,{class:"q-px-none"},{default:n(()=>[l(pa,{dense:""},{default:n(()=>[o(a).dScanIsHistory?(d(),b(U,{key:0,clickable:"",onClick:t[5]||(t[5]=s=>o(X)())},{default:n(()=>[D(" Live ")]),_:1})):g("",!0),(d(!0),u(ga,null,va(o(a).dScanHistory,(s,p)=>(d(),b(U,{class:"myListNoPadding",clickable:"",onClick:h=>o(W)(s.link),active:o(K)(s.link),key:p},{default:n(()=>[l(o(P),{list:s},null,8,["list"])]),_:2},1032,["onClick","active"]))),128))]),_:1})]),_:1})]),_:1},8,["style"])])):g("",!0)],2)])]),l(fa,{modelValue:I.value,"onUpdate:modelValue":t[6]||(t[6]=s=>I.value=s),persistent:""},{default:n(()=>[l(w,{class:"myRoundTop"},{default:n(()=>[l(L,{class:"myCardHeader bg-warning text-center text-h5"},{default:n(()=>[D(" Somthing went wrong ")]),_:1}),l(L,{class:"row items-center"},{default:n(()=>[Ua]),_:1}),l(H,{align:"right"},{default:n(()=>[ya(l(A,{rounded:"",label:"close",color:"primary"},null,512),[[_a]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{$a as default};
