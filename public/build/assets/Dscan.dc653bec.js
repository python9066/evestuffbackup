import{d as h,u as na,i as da,ay as ia,az as ca,a as ra,r as S,U as ua,o as fa,b as ma,c as f,e as u,j as c,f as l,w as o,aA as pa,aB as H,C as m,B as ga,q as b,l as n,ab as _a,_ as k,h as d,n as T,aC as C,A as i,z as A,aD as L,Q as va,aE as B,m as x,s as ya,x as U,F as ha,t as Sa,v as ka,G as Ta}from"./app.94516e8c.js";import{Q as wa,a as E}from"./QTabPanels.43a815f3.js";import{Q as ba}from"./QChip.22faebdf.js";import{c as Ca}from"./copy-to-clipboard.c74fadf2.js";const La={class:"q-ma-md"},xa={class:"row q-gutter-lg"},Ea={key:0,class:"col-9"},Ia={class:"col-2"},Va={key:0,class:"col-auto"},Da={class:"col"},Aa={class:"row justify-between items-center"},Qa={class:"col-auto text-h6"},Ha={class:"col-2"},Ba={class:"col text-h6"},Ua={class:"col text-h6"},ja={class:"col text-h6"},za={key:0,class:"text-red"},Pa={key:0},Oa={key:1},Ra={key:1,class:"text-red"},$a={key:1,class:"col-auto text-h6"},Ga={key:2,class:"col-auto"},qa=c("span",{class:"q-ml-sm"},"There was a error with the EVE ESI while trying add the local scan. You may need to enter the scan again",-1),Ka={__name:"Dscan",setup(Na){const I=h(()=>k(()=>import("./DscanTotal.af383418.js"),["assets/DscanTotal.af383418.js","assets/app.94516e8c.js","assets/app.4fce15f2.css"])),j=h(()=>k(()=>import("./DscanLocal.f418e3d6.js"),["assets/DscanLocal.f418e3d6.js","assets/app.94516e8c.js","assets/app.4fce15f2.css","assets/QImg.d2b3c135.js","assets/DscanLocal.b8f11a2e.css"])),z=h(()=>k(()=>import("./DscanHistoryList.6e371520.js"),["assets/DscanHistoryList.6e371520.js","assets/app.94516e8c.js","assets/app.4fce15f2.css"])),P=h(()=>k(()=>import("./DscanMessage.3dc901a5.js"),["assets/DscanMessage.3dc901a5.js","assets/app.94516e8c.js","assets/app.4fce15f2.css","assets/QBadge.9ca592e1.js","assets/QChatMessage.046282ad.js","assets/DscanMessage.f247a9ce.css"])),O=h(()=>k(()=>import("./index.2ecf75a1.js"),["assets/index.2ecf75a1.js","assets/app.94516e8c.js","assets/app.4fce15f2.css"]));let e=na();da("can");const R=ia();let V=ca(),w=ra(),r=S(null),v=S(null),_=S(!1),p=S("total"),D=S(!1);ua(()=>{}),fa(async()=>{document.title="Evestuff - Dscan",r.value=V.params.link?V.params.link:null,Echo.private("dscanall").listen("DscanAllUpdate",a=>{a.flag.flag==1}),await $()}),ma(()=>{Echo.leave("dscansolo."+r.value),Echo.leave("dscanall")});let $=async()=>{r.value&&(await e.getDscan(r.value),e.dScanIsHistory||Echo.private("dscansolo."+r.value).listen("dScanSoloUpdate",a=>{a.flag.flag==1&&(D.value=!0),a.flag.flag==2&&(e.dScanLocalCorp=a.flag.message.corpsTotal,e.dScanLocalAlliance=a.flag.message.allianceTotal,e.dScanLocalAffiliation=a.flag.message.affiliationTotal,e.updateLocalDscan(a.flag.message.soloLocal)),a.flag.flag==3&&(e.dScanLocalCorp=a.flag.message),a.flag.flag==4&&(e.dScanLocalAlliance=a.flag.message),a.flag.flag==5&&(e.dScan=a.flag.message,e.dScanHistory=a.flag.message.history),a.flag.flag==6&&(e.dScanIsHistory=a.flag.message),a.flag.flag==7&&(e.dScanItemCategory=a.flag.message),a.flag.flag==8&&(e.dScanItemGroup=a.flag.message),a.flag.flag==9&&(e.dScanItemItem=a.flag.message),a.flag.flag==10&&(e.dScanLocalAffiliation=a.flag.message),a.flag.flag==11&&w.push({path:"/dscanisnomore"}),a.flag.flag==12&&(e.dScanMessages=a.flag.message)}))},G=f(()=>!!e.dScan),q=f(()=>e.dScan.system?e.dScan.system.system_name:"unknown"),N=f(()=>e.dScan.madeby?e.dScan.madeby.name:"unknown"),M=f(()=>e.dScan.updated_by?e.dScan.updated_by.name:"unknown"),F=f(()=>e.dScan.updated_at?e.dScan.updated_at:"unknown"),Y=async()=>{_.value=!0;var a={text:v.value};await axios({method:"post",withCredentials:!0,data:a,url:"/api/dscan",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>{_.value=!1,w.push({path:`/dscan/${t.data.link}/`})})},J=async()=>{_.value=!0;var a={text:v.value};await axios({method:"post",withCredentials:!0,data:a,url:"/api/dscan/"+r.value,headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>{_.value=!1,e.dScanLocalCorp=t.data.data.corpsTotal,e.dScanLocalAlliance=t.data.data.allianceTotal,e.dScan=t.data.data.dscan,e.dScanHistory=t.data.data.dscan.history,t.data.data.categoryTotals&&(e.dScanItemCategory=t.data.data.categoryTotals),t.data.data.groupTotals&&(e.dScanItemGroup=t.data.data.groupTotals),t.data.data.itemTotals&&(e.dScanItemItem=t.data.data.itemTotals),t.data.data.affiliationTotal&&(e.dScanLocalAffiliation=t.data.data.affiliationTotal),v.value=null})},K=a=>{if(!a)return 0;let t=a,g=new Date(t).getTimezoneOffset()*6e4;return Date.parse(t)-g},W=f(()=>r.value?"full-height justify-between":"q-gutter-lg full-height justify-end"),X=a=>a==r.value,Z=a=>{w.push({path:`/dscan/${a.link}/${sa(a)}`})},aa=()=>{w.push({path:`/dscan/${e.dScanLiveLink}/${p.value}`})},ea=f(()=>{let a=70;return"height:"+(e.size.height-a+"px")}),ta=f(()=>e.dScan&&e.dScan.locals&&e.dScan.locals.length>0),la=()=>{let a="https://evestuff.apps.gnf.lt"+V.path;Ca(a).then(()=>{R.notify({type:"info",message:a+" copied to your clipboard"})})},sa=a=>{if(p.value=="local"){let t=0;return!a.corpsTotal||Object.values(a.corpsTotal).length==0?t=0:Object.values(a.corpsTotal).forEach(s=>{t+=s.totalInSystem}),t>0?"local":"total"}return p.value},oa=f(()=>{let a=500;return"max-height:"+(e.size.height-a+"px")});return(a,t)=>(d(),u("div",La,[c("div",xa,[G.value?(d(),u("div",Ea,[l(pa,{dense:"",modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),class:"text-teal"},{default:o(()=>[ta.value?(d(),T(C,{key:0,name:"local",label:"Local"})):m("",!0),l(C,{name:"total",label:"Total"}),l(C,{name:"onGrid",label:"On Grid"}),l(C,{name:"offGrid",label:"Off Grid"})]),_:1},8,["modelValue"]),l(wa,{style:H(ea.value),modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=s=>p.value=s),animated:""},{default:o(()=>[l(E,{name:"local"},{default:o(()=>[l(n(j))]),_:1}),l(E,{name:"total"},{default:o(()=>[l(n(I),{type:1})]),_:1}),l(E,{name:"onGrid"},{default:o(()=>[l(n(I),{type:2})]),_:1}),l(E,{name:"offGrid"},{default:o(()=>[l(n(I),{type:3})]),_:1})]),_:1},8,["style","modelValue"])])):m("",!0),c("div",Ia,[c("div",{class:ga([W.value,"column"])},[r.value?(d(),u("div",Va,[l(b,{class:"my-card"},{default:o(()=>[c("div",Da,[c("div",Aa,[c("div",Qa,"System: "+i(q.value),1),c("div",Ha,[l(n(P))])])]),c("div",Ba,"Created By: "+i(N.value),1),c("div",Ua,"Edited By: "+i(M.value),1),c("div",ja,[A(" Last Updated: "),l(n(O),{class:"q-pl-sm","emit-events":!1,time:n(K)(F.value),interval:1e3},{default:o(({hours:s,minutes:g,seconds:y,days:Q})=>[s<=1&&Q==0?(d(),u("span",za,[l(ba,{class:"",filter:"",pill:"",clickable:"",color:"primary","text-color":"white"},{default:o(()=>[s==1?(d(),u("span",Pa,i(s)+":"+i(g)+":"+i(y),1)):(d(),u("span",Oa,i(g)+":"+i(y),1))]),_:2},1024)])):(d(),u("span",Ra,[c("span",null,i(Q)+":"+i(s)+":"+i(g)+":"+i(y),1)]))]),_:1},8,["time"])])]),_:1})])):m("",!0),n(e).dScanIsHistory?m("",!0):(d(),u("div",$a,[l(b,{class:"my-card myRoundTop"},{default:o(()=>[l(L,null,{default:o(()=>[l(va,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=s=>v.value=s),type:"textarea",label:"Paste your Dscan or local here"},null,8,["modelValue"])]),_:1}),l(B,{align:"center"},{default:o(()=>[l(x,{rounded:"",color:"primary",label:"New",loading:_.value,onClick:t[3]||(t[3]=s=>n(Y)())},null,8,["loading"]),r.value?(d(),T(x,{key:0,rounded:"",color:"secondary",label:"Update",loading:_.value,onClick:t[4]||(t[4]=s=>n(J)())},null,8,["loading"])):m("",!0),n(e).dScanHistory.length||n(e).dScanIsHistory?(d(),T(x,{key:1,color:"accent",rounded:"",label:"Share",onClick:n(la)},null,8,["onClick"])):m("",!0)]),_:1})]),_:1})])),n(e).dScanHistory.length||n(e).dScanIsHistory?(d(),u("div",Ga,[l(b,{class:"my-card myRoundTop overflow-auto",style:H(oa.value)},{default:o(()=>[l(L,{class:"q-px-none"},{default:o(()=>[l(ya,{dense:""},{default:o(()=>[n(e).dScanIsHistory?(d(),T(U,{key:0,clickable:"",onClick:t[5]||(t[5]=s=>n(aa)())},{default:o(()=>[A(" Live ")]),_:1})):m("",!0),(d(!0),u(ha,null,Sa(n(e).dScanHistory,(s,g)=>(d(),T(U,{class:"myListNoPadding",clickable:"",onClick:y=>n(Z)(s),active:n(X)(s.link),key:g},{default:o(()=>[l(n(z),{list:s},null,8,["list"])]),_:2},1032,["onClick","active"]))),128))]),_:1})]),_:1})]),_:1},8,["style"])])):m("",!0)],2)])]),l(_a,{modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=s=>D.value=s),persistent:""},{default:o(()=>[l(b,{class:"myRoundTop"},{default:o(()=>[l(L,{class:"myCardHeader bg-warning text-center text-h5"},{default:o(()=>[A(" Somthing went wrong ")]),_:1}),l(L,{class:"row items-center"},{default:o(()=>[qa]),_:1}),l(B,{align:"right"},{default:o(()=>[ka(l(x,{rounded:"",label:"close",color:"primary"},null,512),[[Ta]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ka as default};
