<template>
    <div class=" pr-16 pl-16">
        <messageStations></messageStations>
        <div class=" d-flex align-items-center">
            <v-card-title>Feed Back</v-card-title>

            <v-btn
                :loading="loadingr"
                :disabled="loadingr"
                color="primary"
                class="ma-2 white--text"
                @click="loadFeedBack()"
            >
                Update
                <v-icon right dark>fas fa-sync-alt fa-xs</v-icon>
            </v-btn>

            <v-text-field
                v-model="search"
                append-icon="mdi-magnify"
                label="Search"
                single-line
                hide-details
            ></v-text-field>

            <!-- <v-btn-toggle
                right-align
                v-model="toggle_exclusive"
                mandatory
                :value="0"
            >
                <v-btn
                    :loading="loadingf"
                    :disabled="loadingf"
                    @click="statusflag = 1"
                >
                    All
                </v-btn>
                <v-btn
                    :loading="loadingf"
                    :disabled="loadingf"
                    @click="statusflag = 2"
                >
                    On The Way
                </v-btn>
                <v-btn
                    :loading="loadingf"
                    :disabled="loadingf"
                    @click="statusflag = 3"
                >
                    Gunning
                </v-btn>
            </v-btn-toggle> -->
        </div>
        <v-data-table
            :headers="headers"
            :items="this.data"
            :expanded.sync="expanded"
            item-key="id"
            :loading="loadingt"
            :items-per-page="25"
            :footer-props="{ 'items-per-page-options': [15, 25, 50, 100, -1] }"
            :sort-by="['created']"
            :search="search"
            :sort-desc="[true, false]"
            multi-sort
            class="elevation-1"
        >
            >

            <template slot="no-data">
                No feed back atm
            </template>

             <template v-slot:expanded-item="{ headers, item }">
                        <td :colspan="headers.length" align="center">
                            <div>
                                <v-col class="align-center">
                                    <v-textarea
                                        v-model="item.text"
                                        label="Where you can put any notes"
                                        outlined
                                        shaped
                                    >{{item.text}}</v-textarea>
                                </v-col>
                            </div>
                        </td>
                    </template>


        </v-data-table>
        <v-snackbar v-model="snack" :timeout="3000" :color="snackColor">
            {{ snackText }}

            <template v-slot:action="{ attrs }">
                <v-btn v-bind="attrs" text @click="snack = false">Close</v-btn>
            </template>
        </v-snackbar>
    </div>
</template>
<script>
import Axios from "axios";
import moment from "moment";
import { stringify } from "querystring";
import { mapState } from "vuex";
import ApiL from "../service/apil";
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
export default {
    data() {
        return {
            atime: null,
            check: "not here",
            componentKey: 0,
            data: [],
            dialog1: false,
            dialog2: false,
            dialog3: false,
            diff: 0,
            endcount: "",
            expanded: [],
            expanded_id: 0,
            icon: "justify",
            loadingt: true,
            loadingf: true,
            loadingr: true,
            name: "Timer",
            poll: null,
            search: "",
            statusflag: 4,
            snack: false,
            snackColor: "",
            snackText: "",
            toggle_exclusive: 0,
            today: 0,
            text: "center",
            toggle_none: null,

            dropdown_edit: [
                { title: "On My Way", value: 2 },
                { title: "Gunning", value: 3 },
                { title: "Saved", value: 4 },
                { title: "Reffed - Shield", value: 8 },
                { title: "Reffed - Armor", value: 9 },
                { title: "New", value: 1 }
            ],

            headers: [
                { text: "User", value: "user_name" },
                { text: "Date", value: "created" },
                { text: "Actions", value: "", align: "end" }

                // { text: "Vulernable End Time", value: "vulnerable_end_time" }
            ]
        };
    },

    created() {
        this.loadFeedBack();
    },

    async mounted() {},
    methods: {
        checkexpanded(FeedBack) {
            if (FeedBack.id == this.expanded_id) {
                this.expanded = [];
                this.expanded_id = 0;
            }
        },

        async loadFeedBack() {
            let res = await axios({
                method: "GET", //you can set what request you want to be
                url: "api/feedback",
                headers: {
                    Authorization: "Bearer " + this.$store.state.token,
                    Accept: "application/json",
                    "Content-Type": "application/json"
                }
            });
            this.data = res.data.feedback;
            this.loadingr = false;
        },

        save() {
            this.snack = true;
            this.snackColor = "success";
            this.snackText = "Data saved";
        },
        cancel() {
            this.snack = true;
            this.snackColor = "error";
            this.snackText = "Canceled";
        },
        open() {
            this.snack = true;
            this.snackColor = "info";
            this.snackText = "Dialog opened";
        },
        close() {},

        sec(item) {
            var a = moment.utc();
            var b = moment(item.timestamp);
            this.diff = a.diff(b);
            return this.diff;
        }

        // handleCountdownEnd() {
        //     console.log("hi");
        // }
        // handleCountdownEnd(item) {
        //     console.log('hi')
        //     this.$store.dispatch('markOver',item);
        // },
    },

    computed: {
        user_name() {
            return this.$store.state.user_name;
        }
    },
    beforeDestroy() {
        // clearInterval(this.poll);
        // console.log('KILL THEM ALL');
    }
};
</script>
